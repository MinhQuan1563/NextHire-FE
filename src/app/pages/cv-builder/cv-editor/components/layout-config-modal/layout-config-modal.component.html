<div *ngIf="show" class="modal-overlay" (click)="onClose()">
  <div class="modal-content large" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3>C·∫•u h√¨nh Layout CV</h3>
      <button class="modal-close" (click)="onClose()">‚úï</button>
    </div>

    <div class="modal-body">
      <!-- Layout Basic Info -->
      <div class="config-section">
        <h4>Th√¥ng tin c∆° b·∫£n</h4>
        <div class="form-row">
          <div class="form-group">
            <label for="layoutName">T√™n Layout *</label>
            <input
              id="layoutName"
              type="text"
              [(ngModel)]="configForm.name"
              placeholder="VD: Layout 2 c·ªôt c∆° b·∫£n"
              class="form-input"
              required
            />
          </div>
          <div class="form-group">
            <label class="checkbox-label">
              <input 
                type="checkbox" 
                [(ngModel)]="configForm.isDefault"
              />
              <span class="checkmark"></span>
              ƒê·∫∑t l√†m layout m·∫∑c ƒë·ªãnh
            </label>
          </div>
        </div>
        
        <div class="form-group">
          <label for="layoutDescription">M√¥ t·∫£</label>
          <textarea
            id="layoutDescription"
            [(ngModel)]="configForm.description"
            placeholder="M√¥ t·∫£ layout n√†y..."
            class="form-textarea"
            rows="2"
          ></textarea>
        </div>
      </div>

      <!-- Layout Configuration -->
      <div class="config-section">
        <div class="section-header">
          <h4>C·∫•u h√¨nh Layout ({{ configForm.rows?.length || 0 }} d√≤ng, {{ configForm.totalColumns }} c·ªôt t·ªëi ƒëa)</h4>
          <button class="btn btn-sm btn-primary" (click)="addRow()">
            <i class="icon">‚ûï</i>
            Th√™m d√≤ng
          </button>
        </div>

        <!-- Layout Preview -->
        <div class="layout-preview">
          <div 
            *ngFor="let row of configForm.rows; let rowIndex = index; trackBy: trackByRow"
            class="layout-row"
          >
            <!-- Row Header -->
            <div class="row-header">
              <div class="row-info">
                <span class="row-label">D√≤ng {{ rowIndex + 1 }}</span>
                <span class="row-meta">{{ row.columns.length }} c·ªôt ‚Ä¢ {{ getTotalWidth(row) }}% t·ªïng chi·ªÅu r·ªông</span>
              </div>
              <div class="row-actions">
                <button 
                  class="btn btn-xs btn-secondary"
                  (click)="addColumn(rowIndex)"
                  [disabled]="row.columns.length >= 4"
                >
                  <i class="icon">‚ûï</i>
                  Th√™m c·ªôt
                </button>
                <button 
                  class="btn btn-xs btn-danger"
                  (click)="removeRow(rowIndex)"
                  [disabled]="configForm.rows!.length <= 1"
                >
                  <i class="icon">üóëÔ∏è</i>
                  X√≥a d√≤ng
                </button>
              </div>
            </div>

            <!-- Row Columns -->
            <div class="row-columns">
              <div 
                *ngFor="let column of row.columns; let columnIndex = index; trackBy: trackByColumn"
                class="layout-column"
                [style.flex]="'0 0 ' + column.widthPercentage + '%'"
              >
                <div class="column-header">
                  <span class="column-label">C·ªôt {{ columnIndex + 1 }}</span>
                  <button 
                    class="btn btn-xs btn-danger"
                    (click)="removeColumn(rowIndex, columnIndex)"
                    [disabled]="row.columns.length <= 1"
                  >
                    ‚úï
                  </button>
                </div>
                
                <div class="column-body">
                  <div class="width-control">
                    <label>Chi·ªÅu r·ªông:</label>
                    <div class="width-input-group">
                      <input
                        type="range"
                        [value]="column.widthPercentage"
                        (input)="onWidthChange(rowIndex, columnIndex, $event)"
                        min="10"
                        max="90"
                        class="width-slider"
                      />
                      <input
                        type="number"
                        [value]="column.widthPercentage"
                        (input)="onWidthChange(rowIndex, columnIndex, $event)"
                        min="10"
                        max="90"
                        class="width-number"
                      />
                      <span class="width-unit">%</span>
                    </div>
                  </div>
                  
                  <div class="column-preview">
                    <div class="drop-zone">
                      <i class="zone-icon">üìÑ</i>
                      <span class="zone-text">Khu v·ª±c k√©o th·∫£</span>
                      <small class="zone-meta">{{ column.sections.length }} section</small>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Layout Summary -->
        <div class="layout-summary">
          <div class="summary-item">
            <strong>T·ªïng d√≤ng:</strong> {{ configForm.rows?.length || 0 }}
          </div>
          <div class="summary-item">
            <strong>C·ªôt t·ªëi ƒëa:</strong> {{ configForm.totalColumns }}
          </div>
          <div class="summary-item">
            <strong>T·ªïng v√πng k√©o th·∫£:</strong> 
            {{ getTotalDropZones() }}
          </div>
        </div>
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="onClose()">
        H·ªßy
      </button>
      <button class="btn btn-primary" (click)="onSave()">
        L∆∞u Layout
      </button>
    </div>
  </div>
</div>