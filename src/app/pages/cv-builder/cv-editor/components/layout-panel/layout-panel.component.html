<div class="panel">
  <h3>B·ªë c·ª•c CV</h3>
  <p class="panel-description">
    K√©o th·∫£ ƒë·ªÉ s·∫Øp x·∫øp l·∫°i th·ª© t·ª± c√°c m·ª•c, di chuy·ªÉn gi·ªØa c√°c c·ªôt v√† h√†ng, ho·∫∑c th√™m/b·ªõt m·ª•c ƒë·ªÉ t√πy ch·ªânh b·ªë c·ª•c CV.
  </p>

  <!-- Layout Grid: Rows and Columns -->
  <div class="layout-grid" *ngIf="rows && rows.length > 0">
    <h4 class="section-group-title">B·ªë c·ª•c l∆∞·ªõi</h4>

    <!-- Each Row -->
    <div
      *ngFor="let row of rows; trackBy: trackByRowId"
      class="layout-row"
      [attr.data-row-id]="row.id"
    >
      <div class="row-header">
        <span class="row-label">H√†ng {{ row.order }}</span>
        <span class="row-info">({{ row.columns.length || 0 }} c·ªôt)</span>
      </div>

      <!-- Columns within the row -->
      <div class="row-columns">
        <div
          *ngFor="let column of row.columns; trackBy: trackByColumnId"
          class="layout-column"
          [attr.data-column-id]="column.id"
          [style.flex]="column.widthPercentage"
          (dragover)="onDragOver($event)"
          (drop)="onDropOnColumn($event, row.id, column.id)"
        >
          <div class="column-header">
            <span class="column-label">C·ªôt ({{ column.widthPercentage }}%)</span>
          </div>

          <!-- Sections within the column -->
          <div class="column-sections">
            <div
              *ngFor="let sectionId of column.sections; let idx = index; trackBy: trackBySectionId"
              class="section-card"
              [attr.draggable]="!isSectionLocked(sectionId)"
              [class.locked]="isSectionLocked(sectionId)"
              (dragstart)="onDragStartFromLayout($event, sectionId, row.id, column.id)"
              (dragover)="onDragOver($event)"
              (drop)="onDropOnSection($event, sectionId, row.id, column.id)"
            >
              <!-- Drag handle -->
              <div class="drag-handle" [class.locked]="isSectionLocked(sectionId)">
                <i class="icon-drag" *ngIf="!isSectionLocked(sectionId)">‚ãÆ‚ãÆ</i>
                <i class="icon-lock" *ngIf="isSectionLocked(sectionId)">üîí</i>
              </div>

              <!-- Section info -->
              <div class="section-info">
                <span class="section-number">{{ idx + 1 }}</span>
                <span class="section-name">{{ getSectionName(sectionId) }}</span>
              </div>

              <!-- Remove button -->
              <button
                *ngIf="!isSectionLocked(sectionId)"
                class="remove-button"
                (click)="onRemoveSectionFromLayout(sectionId, row.id, column.id)"
                title="X√≥a m·ª•c n√†y kh·ªèi b·ªë c·ª•c"
                type="button"
              >
                <i class="icon-trash">üóëÔ∏è</i>
              </button>
            </div>

            <!-- Empty column placeholder -->
            <div *ngIf="!column.sections || column.sections.length === 0" class="empty-column-placeholder">
              <p class="placeholder-text">K√©o th·∫£ m·ª•c v√†o ƒë√¢y</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Empty layout state -->
  <div *ngIf="!rows || rows.length === 0" class="empty-layout">
    <p>Ch∆∞a c√≥ b·ªë c·ª•c n√†o ƒë∆∞·ª£c c·∫•u h√¨nh.</p>
    <p class="hint">S·ª≠ d·ª•ng "Qu·∫£n l√Ω Layout" ƒë·ªÉ t·∫°o c·∫•u tr√∫c h√†ng v√† c·ªôt.</p>
  </div>

  <!-- Unused Sections Area -->
  <div
    class="unused-sections"
    *ngIf="unusedSections && unusedSections.length > 0"
    (dragover)="onDragOver($event)"
    (drop)="onDropOnUnused($event)"
  >
    <h4 class="section-group-title">M·ª•c ch∆∞a s·ª≠ d·ª•ng</h4>
    <p class="unused-hint">K√©o c√°c m·ª•c d∆∞·ªõi ƒë√¢y v√†o l∆∞·ªõi b·ªë c·ª•c ƒë·ªÉ th√™m v√†o CV</p>

    <div class="unused-sections-grid">
      <div
        *ngFor="let section of unusedSections; trackBy: trackByUnusedId"
        class="unused-section-chip"
        [attr.draggable]="!section.locked"
        [class.locked]="section.locked"
        (dragstart)="onDragStartFromUnused($event, section)"
        (click)="onQuickAddSection(section)"
      >
        <span class="chip-icon" *ngIf="!section.locked">‚ûï</span>
        <span class="chip-icon" *ngIf="section.locked">üîí</span>
        <span class="chip-name">{{ section.name }}</span>
        <span class="chip-hint" *ngIf="!section.locked">Nh·∫•n ho·∫∑c k√©o</span>
        <span class="chip-hint" *ngIf="section.locked">ƒê√£ kh√≥a</span>
      </div>
    </div>
  </div>

  <!-- No unused sections message -->
  <div *ngIf="!unusedSections || unusedSections.length === 0" class="no-unused">
    <p class="info-text">‚úì T·∫•t c·∫£ c√°c m·ª•c ƒë√£ ƒë∆∞·ª£c s·ª≠ d·ª•ng trong b·ªë c·ª•c</p>
  </div>
</div>
